name: deploy
on:
  push:
    branches:
      - feature/deploy
env: 
  FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
jobs:
  deploy:
    name: Deploy server
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: superfly/flyctl-actions/setup-flyctl@master
      - run: flyctl deploy --remote-only
        env:
          MODE: ${{secrets.MODE}}
          LOG_LEVEL: ${{secrets.LOG_LEVEL}}
          LOG_FOLDER: ${{secrets.LOG_FOLDER}}
          MONGO_CONNECTION_STRING_FORMAT: ${{secrets.MONGO_CONNECTION_STRING_FORMAT}}
          MONGO_SERVER_HOST: ${{secrets.MONGO_SERVER_HOST}}
          MONGO_DATABASE_NAME: ${{secrets.MONGO_DATABASE_NAME}}
          MONGO_AUTHENTICATION: ${{secrets.MONGO_AUTHENTICATION}}
          MONGO_USER: ${{secrets.MONGO_USER}}
          MONGO_PASSWORD: ${{secrets.MONGO_PASSWORD}}
          AUTH_AUDIENCE: ${{secrets.AUTH_AUDIENCE}}
          AUTH_ISSUER_BASE_URL: ${{secrets.AUTH_ISSUER_BASE_URL}}
          TREBLLE_API_KEY: ${{secrets.TREBLLE_API_KEY}}
          TREBLLE_PROJECT_ID: ${{secrets.TREBLLE_PROJECT_ID}}
